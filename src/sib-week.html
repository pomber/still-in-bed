<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="sib-icons.html">
<link rel="import" href="sib-day-tile.html">
<link rel="import" href="sib-today-tile.html">

<dom-module id="sib-week">
  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
        color: white;
        display: block;
        width: 100%;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
      }

      .container {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);
        width: 100%;
        /*border: solid 1px;*/
        background-color: var(--paper-light-blue-400);
      }

      .tile {
        @apply(--layout-vertical);
        @apply(--layout-center);
        @apply(--layout-end-justified);
        /*@apply(--layout-center-justified);*/

        border-radius: 8px;
        /*border: 1px solid;*/
        /*background: rgba(200, 255, 200, 0.15);*/

        width: 14%;
        height: 40px;
      }

      .tile.miss {
        /*background: rgba(255, 100, 100, 0.15);*/
      }

      .time {
        @apply(--paper-font-common-base);
        font-size: 17px;
        font-weight: 300;
        text-align: center;
        /*line-height: 36px;*/
      }

      .date {
        @apply(--paper-font-common-base);
        font-size: 16px;
        font-weight: 300;
        /*text-transform: uppercase;*/
        /*width: 100%;*/
        text-align: center;
        /*padding-right: 10px;*/
        opacity: 0.7;
        /*border-bottom: solid 1px;*/
      }

      .marker {
        display: none;
        border-left-style: solid;
        border-left-width: 0;
        margin-left: 20px;
        height: 4px;
        /*opacity: 0.7;*/
        color: var(--paper-amber-300);
      }

      .tile.today {
        width: 286px;
        height: 60px;
      }

      svg {
        width: 100vw;
        height: 50vw;
        background-color: var(--paper-light-blue-300);
      }

      svg path {
        stroke-opacity: 0.7;
        stroke: white;
        fill: var(--paper-light-blue-400);
        stroke-width: 2;
        stroke-linejoin: round;
      }

      svg circle {
        r: 2;
        fill: white;
        fill-opacity: 0.7;
        stroke: white;
        stroke-width: 5;
        stroke-opacity: 0.3;
      }

      svg text {
        @apply(--paper-font-common-base);
        font-size: 9px;
        font-weight: 200;
        stroke-opacity: 0.2;
        stroke: white;
        fill: white;
        fill-opacity: 0.2;
        text-anchor: middle;
      }
    </style>

    <div class="container">

      <svg id="svg"
        xmlns="http://www.w3.org/2000/svg" version="1.1" 
        viewBox="0 0 200 100">        
      </svg>

      <template is="dom-repeat" items="[[items]]">
        <div class$="tile [[item.klass]]">
          <!--<span class="time">[[item.time]]</span>-->
          <span class="date">[[item.date]]</span>
          <!--<span class="marker" style$="[[item.marker]]">&nbsp</span>-->
        </div>
      </template>
      <!--<div class="tile today">
        <span class="date">[[item.date]]</span>
        <span class="time">[[item.time]]</span>
      </div>    -->
        

    </div>

  </template>

  <script>
    Polymer({

      is: 'sib-week',

      properties: {
        items: {
          value: [
            { time: '07:20', date: 'M' },
            { time: '08:05', date: 'T' },
            { time: '  -  ', date: 'W' },
            { time: '07:22', date: 'OCT 06' },
            { time: '07:20', date: 'F' },
            { time: '09:43', date: 'S' },
            { time: '09:11', date: 'S' },
          ]
        },
        coords: {
          value: [
            { x:  18, y: 30, l: 'M' },
            { x:  46, y: 40, l: 'T' },
            { x:  74, y: 76, l: 'W' },
            { x: 102, y: 35, l: 'T' },
            { x: 130, y:  5, l: 'F' },
            { x: 158, y: 50, l: 'S' },
            { x: 186, y: 20, l: 'S' },
          ]
        }
      },

      observers: [
        '_render(coords.*)'
      ],

      _render: function() {
        var svg = Polymer.dom(this.$.svg);

        while (svg.firstChild) {
          svg.removeChild(svg.firstChild);
        }

        var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', this._getPath());
        svg.appendChild(path);        

        for (i = 0; i < this.coords.length; i++) {
          var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          circle.setAttribute('cx', this.coords[i].x);
          circle.setAttribute('cy', this.coords[i].y);
          svg.appendChild(circle);

          // if (i % 3 <= 3) {
          //   var txtNode = document.createTextNode(this.coords[i].l);
          //   var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
          //   text.setAttribute('x', this.coords[i].x);
          //   text.setAttribute('y', this.coords[i].y);
          //   text.setAttribute('dy', 13);
          //   text.appendChild(txtNode);  
          //   svg.appendChild(text);
          // }
        }
      },

      _getPath: function() {
        if (!this.coords || !this.coords.length) return '';

        var y0 = this.coords[0].y;
        var path = 'M-5 ' + y0;

        for (var i = 0; i < this.coords.length; i++) {
          var c = this.coords[i];
          var p = i == 0 ? 
            {x: c.x-10, y: c.y} : this.coords[i-1];
          var n = i == this.coords.length-1 ? 
            {x: c.x+10, y: c.y} : this.coords[i+1];

          path += ' C'
            + (p.x + c.x) / 2 + ' ' + p.y + ' '
            + (p.x + c.x) / 2 + ' ' + c.y + ' ' 
            + c.x + ' ' + c.y;
        }

        path += ' h100 v500 h-500';
        console.log(path);
        return path;
      }

    });
  </script>
</dom-module>